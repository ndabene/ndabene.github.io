{% comment %}
Widget Trending Topics - Affiche les articles populaires avec métriques simulées
{% endcomment %}

{% assign trending_posts = site.posts | where_exp: "post", "post.date <= site.time" | slice: 0, 5 %}

{% if trending_posts.size > 0 %}
<div class="sidebar-widget-compact">
    <h4><i class="fas fa-fire"></i> Tendances</h4>
    <div class="trending-topics-list">
        {% for post in trending_posts %}
            {% assign days_since_published = site.time | date: '%s' | minus: post.date | date: '%s' | divided_by: 86400 %}
            {% assign base_views = 100 %}
            {% assign recency_factor = 500 | divided_by: days_since_published | plus: 1 %}
            {% assign simulated_views = base_views | times: recency_factor | plus: 50 %}

            <article class="trending-topic-item">
                <a href="{{ post.url | relative_url }}" class="trending-link">
                    {% if post.image %}
                        <div class="trending-thumb">
                            <img src="{{ post.image }}" alt="{{ post.title }}" loading="lazy">
                        </div>
                    {% endif %}

                    <div class="trending-content">
                        <h5 class="trending-title">{{ post.title | truncate: 60 }}</h5>

                        <div class="trending-stats">
                            <span class="trending-stat">
                                <i class="fas fa-eye"></i>
                                {{ simulated_views }}
                            </span>

                            {% if post.content %}
                                {% assign words = post.content | strip_html | number_of_words %}
                                {% assign read_time = words | divided_by: 200 %}
                                {% if read_time < 1 %}{% assign read_time = 1 %}{% endif %}
                                <span class="trending-stat">
                                    <i class="fas fa-clock"></i>
                                    {{ read_time }} min
                                </span>
                            {% endif %}
                        </div>

                        {% if days_since_published <= 7 %}
                            <span class="trending-badge trending-hot">
                                <i class="fas fa-fire"></i> Hot
                            </span>
                        {% elsif days_since_published <= 30 %}
                            <span class="trending-badge trending-new">
                                <i class="fas fa-star"></i> Nouveau
                            </span>
                        {% endif %}
                    </div>
                </a>
            </article>
        {% endfor %}
    </div>
</div>
{% endif %}
