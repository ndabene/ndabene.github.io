{% comment %}
  Recommandations croisées entre expertises
  Suggère des articles de thématiques différentes pour élargir les horizons
  Usage: {% include cross-topic-recommendations.html %}
{% endcomment %}

{% comment %}Détecter les thématiques du post actuel{% endcomment %}
{% assign current_categories = page.categories | join: "," | downcase %}
{% assign current_tags = page.tags | join: "," | downcase %}

{% assign has_prestashop = false %}
{% assign has_ia = false %}
{% assign has_php = false %}
{% assign has_performance = false %}
{% assign has_securite = false %}

{% if current_categories contains "prestashop" or current_tags contains "prestashop" %}
  {% assign has_prestashop = true %}
{% endif %}

{% if current_categories contains "intelligence" or current_categories contains "ia" or current_tags contains "ia" %}
  {% assign has_ia = true %}
{% endif %}

{% if current_categories contains "php" or current_tags contains "php" %}
  {% assign has_php = true %}
{% endif %}

{% if current_categories contains "performance" or current_tags contains "performance" %}
  {% assign has_performance = true %}
{% endif %}

{% if current_categories contains "sécurité" or current_tags contains "sécurité" %}
  {% assign has_securite = true %}
{% endif %}

{% comment %}Collecter des articles de thématiques complémentaires{% endcomment %}
{% assign cross_posts = "" | split: "" %}
{% assign published_posts = site.posts | where_exp: "post", "post.date <= site.time" %}

{% for post in published_posts %}
  {% if post.url != page.url %}
    {% assign post_cats = post.categories | join: "," | downcase %}
    {% assign post_tags = post.tags | join: "," | downcase %}
    {% assign is_different_topic = false %}

    {% comment %}Si l'article actuel est sur PrestaShop, suggérer IA ou Performance{% endcomment %}
    {% if has_prestashop %}
      {% if post_cats contains "intelligence" or post_tags contains "ia" or post_cats contains "performance" %}
        {% assign is_different_topic = true %}
      {% endif %}
    {% endif %}

    {% comment %}Si l'article actuel est sur IA, suggérer PrestaShop ou PHP{% endcomment %}
    {% if has_ia %}
      {% if post_cats contains "prestashop" or post_cats contains "php" or post_cats contains "développement" %}
        {% assign is_different_topic = true %}
      {% endif %}
    {% endif %}

    {% comment %}Si l'article actuel est sur Performance, suggérer PrestaShop ou Sécurité{% endcomment %}
    {% if has_performance %}
      {% if post_cats contains "prestashop" or post_cats contains "sécurité" %}
        {% assign is_different_topic = true %}
      {% endif %}
    {% endif %}

    {% comment %}Si l'article actuel est sur PHP, suggérer IA ou Sécurité{% endcomment %}
    {% if has_php %}
      {% if post_cats contains "intelligence" or post_tags contains "ia" or post_cats contains "sécurité" %}
        {% assign is_different_topic = true %}
      {% endif %}
    {% endif %}

    {% if is_different_topic %}
      {% assign cross_posts = cross_posts | push: post %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if cross_posts.size > 0 %}
<!-- Schema.org pour les articles suggérés -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Articles suggérés",
  "description": "Autres sujets techniques qui pourraient vous intéresser",
  "itemListElement": [
    {% for post in cross_posts limit: 3 %}
    {
      "@type": "ListItem",
      "position": {{ forloop.index }},
      "item": {
        "@type": "Article",
        "@id": "{{ post.url | absolute_url }}",
        "url": "{{ post.url | absolute_url }}",
        "headline": "{{ post.title | escape }}",
        "description": "{{ post.excerpt | strip_html | truncate: 120 | escape }}",
        "datePublished": "{{ post.date | date_to_xmlschema }}",
        "dateModified": "{{ post.last_modified_at | default: post.date | date_to_xmlschema }}",
        "author": {
          "@type": "Person",
          "name": "{{ post.author | default: site.author.name }}",
          "url": "{{ site.url }}",
          "jobTitle": "Senior PHP FullStack Developer & AI Orchestrator"
        },
        "publisher": {
          "@type": "Person",
          "name": "{{ site.author.name }}",
          "url": "{{ site.url }}"
        }{% if post.image %},
        "image": {
          "@type": "ImageObject",
          "url": "{{ post.image | absolute_url }}",
          "width": 1200,
          "height": 630
        }{% endif %}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>

<section class="cross-topic-recommendations">
  <div class="cross-header">
    <h2>
      <i class="fas fa-lightbulb"></i>
      Vous pourriez aussi aimer
    </h2>
    <p class="cross-subtitle">Découvrez d'autres sujets techniques qui pourraient vous intéresser</p>
  </div>

  <div class="cross-grid">
    {% for post in cross_posts limit: 3 %}
      <article class="cross-card">
        <a href="{{ post.url | relative_url }}" class="cross-card-link">
          {% if post.image %}
          <div class="cross-card-image">
            <img src="{{ post.image }}" alt="{{ post.title | escape }}" loading="lazy">
            <div class="cross-card-overlay">
              <span class="cross-card-cta">
                <i class="fas fa-arrow-right"></i>
                Lire l'article
              </span>
            </div>
          </div>
          {% endif %}

          <div class="cross-card-content">
            {% if post.categories.first %}
            <span class="cross-category">
              {{ post.categories.first }}
            </span>
            {% endif %}

            <h3 class="cross-card-title">{{ post.title }}</h3>

            <p class="cross-card-excerpt">
              {{ post.excerpt | strip_html | truncate: 120 }}
            </p>

            <div class="cross-card-meta">
              <span class="cross-date">
                <i class="far fa-calendar"></i>
                {% include date-fr.html date=post.date %}
              </span>
              <span class="cross-read-time">
                <i class="far fa-clock"></i>
                {% if post.estimated_reading_time %}
                  {{ post.estimated_reading_time | remove: ' minutes' }} min
                {% else %}
                  5 min
                {% endif %}
              </span>
            </div>

            {% if post.tags %}
            <div class="cross-tags">
              {% for tag in post.tags limit:2 %}
                <span class="cross-tag">#{{ tag }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </a>
      </article>
    {% endfor %}
  </div>

  <div class="cross-footer">
    <a href="/blog/" class="btn btn--outline">
      <i class="fas fa-th"></i>
      Explorer tous les articles
    </a>
  </div>
</section>

<style>
.cross-topic-recommendations {
  margin: 4rem 0;
  padding: 3rem;
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #fae8ff 100%);
  border-radius: 20px;
  border: 2px solid #e9d5ff;
}

.cross-header {
  text-align: center;
  margin-bottom: 3rem;
}

.cross-header h2 {
  font-size: 2rem;
  font-weight: 700;
  color: #7c3aed;
  margin: 0 0 0.75rem 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.cross-header h2 i {
  font-size: 1.75rem;
}

.cross-subtitle {
  color: #7c3aed;
  font-size: 1.0625rem;
  margin: 0;
  opacity: 0.8;
}

.cross-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.cross-card {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.15);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.cross-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 40px rgba(124, 58, 237, 0.25);
  border-color: #7c3aed;
}

.cross-card-link {
  text-decoration: none;
  color: inherit;
  display: block;
}

.cross-card-image {
  position: relative;
  width: 100%;
  height: 200px;
  overflow: hidden;
}

.cross-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s ease;
}

.cross-card:hover .cross-card-image img {
  transform: scale(1.1);
}

.cross-card-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(168, 85, 247, 0.9));
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cross-card:hover .cross-card-overlay {
  opacity: 1;
}

.cross-card-cta {
  color: white;
  font-weight: 600;
  font-size: 1.125rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.cross-card-cta i {
  transition: transform 0.3s ease;
}

.cross-card:hover .cross-card-cta i {
  transform: translateX(5px);
}

.cross-card-content {
  padding: 1.5rem;
}

.cross-category {
  display: inline-block;
  background: linear-gradient(135deg, #7c3aed, #a855f7);
  color: white;
  padding: 0.375rem 1rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 1rem;
}

.cross-card-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 1rem 0;
  line-height: 1.4;
}

.cross-card-excerpt {
  color: #64748b;
  font-size: 0.9375rem;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.cross-card-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.8125rem;
  color: #94a3b8;
  margin-bottom: 1rem;
}

.cross-card-meta span {
  display: flex;
  align-items: center;
  gap: 0.375rem;
}

.cross-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.cross-tag {
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  color: #475569;
  padding: 0.25rem 0.75rem;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 500;
}

.cross-footer {
  margin-top: 3rem;
  text-align: center;
}

.btn--outline {
  background: white;
  color: #7c3aed;
  border: 2px solid #7c3aed;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s ease;
}

.btn--outline:hover {
  background: #7c3aed;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
}

@media (max-width: 768px) {
  .cross-topic-recommendations {
    padding: 2rem 1.5rem;
  }

  .cross-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .cross-header h2 {
    font-size: 1.75rem;
  }
}
</style>
{% endif %}
