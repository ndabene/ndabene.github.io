{% comment %}
  SÃ©lecteur de langue
  Affiche un lien vers la version traduite de la page actuelle
  Utilise le systÃ¨me de 'ref' pour trouver les traductions
{% endcomment %}

{% assign current_lang = page.lang | default: site.default_lang %}
{% assign translations = site.data.i18n %}

<div class="language-switcher">
  {% comment %} Pour les articles de blog {% endcomment %}
  {% if page.ref and page.collection == 'posts' or page.collection == 'posts_en' %}
    {% assign all_posts = site.posts | concat: site.posts_en %}
    {% assign has_translation = false %}

    {% for alt_post in all_posts %}
      {% if alt_post.ref == page.ref and alt_post.lang != current_lang %}
        {% assign has_translation = true %}
        <a href="{{ alt_post.url | relative_url }}"
           class="lang-link"
           hreflang="{{ alt_post.lang }}"
           title="{% if alt_post.lang == 'en' %}Read in English{% else %}Lire en franÃ§ais{% endif %}">
          <span class="lang-icon">ğŸŒ</span>
          <span class="lang-text">{{ translations[alt_post.lang].lang_name }}</span>
        </a>
      {% endif %}
    {% endfor %}

    {% unless has_translation %}
      {% comment %} Pas de traduction disponible, lien vers homepage {% endcomment %}
      {% if current_lang == 'fr' %}
        <a href="/en/" class="lang-link" hreflang="en" title="Switch to English">
          <span class="lang-icon">ğŸŒ</span>
          <span class="lang-text">English</span>
        </a>
      {% else %}
        <a href="/" class="lang-link" hreflang="fr" title="Passer en franÃ§ais">
          <span class="lang-icon">ğŸŒ</span>
          <span class="lang-text">FranÃ§ais</span>
        </a>
      {% endif %}
    {% endunless %}
  {% else %}
    {% comment %} Pour les pages statiques {% endcomment %}
    {% if current_lang == 'fr' %}
      {% comment %} Construire l'URL anglaise {% endcomment %}
      {% if page.url == '/' or page.url == '/index.html' %}
        {% assign en_url = '/en/' %}
      {% else %}
        {% assign en_url = page.url | prepend: '/en' %}
      {% endif %}
      <a href="{{ en_url }}" class="lang-link" hreflang="en" title="Switch to English">
        <span class="lang-icon">ğŸŒ</span>
        <span class="lang-text">English</span>
      </a>
    {% else %}
      {% comment %} Construire l'URL franÃ§aise {% endcomment %}
      {% assign fr_url = page.url | remove_first: '/en' %}
      {% if fr_url == '' or fr_url == '/' %}
        {% assign fr_url = '/' %}
      {% endif %}
      <a href="{{ fr_url }}" class="lang-link" hreflang="fr" title="Passer en franÃ§ais">
        <span class="lang-icon">ğŸŒ</span>
        <span class="lang-text">FranÃ§ais</span>
      </a>
    {% endif %}
  {% endif %}
</div>
