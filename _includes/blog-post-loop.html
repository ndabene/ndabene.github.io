{% comment %}
Boucle pour afficher les posts avec gestion des futurs posts
Usage: {% include blog-post-loop.html posts=site.posts limit=6 %}
{% endcomment %}

{% assign posts_to_show = include.posts | default: site.posts %}
{% assign post_limit = include.limit | default: 999 %}

<!-- Script pour d√©tecter le mode admin avant le rendu -->
<script>
// Fonction pour v√©rifier le mode admin d√®s le chargement
(function() {
    const urlParams = new URLSearchParams(window.location.search);
    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const isAdmin = urlParams.get('admin_preview') === 'true' ||
                    sessionStorage.getItem('admin_preview') === 'true' ||
                    isLocalhost; // Auto-activer en local

    console.log('üéØ Blog Post Loop - Admin Detection:', {
        hostname: window.location.hostname,
        isLocalhost: isLocalhost,
        urlParam: urlParams.get('admin_preview'),
        sessionStorage: sessionStorage.getItem('admin_preview'),
        isAdmin: isAdmin
    });

    if (isAdmin) {
        // Marquer le mode admin avant que la page soit compl√®tement rendue
        document.documentElement.classList.add('admin-preview-active');
        sessionStorage.setItem('admin_preview', 'true');
        console.log('‚úÖ admin-preview-active class added to <html>');
    } else {
        console.log('‚ùå Admin mode not active - future posts will be hidden');
    }
})();
</script>

<style>
/* Styles pour afficher les futurs posts en mode admin */
html:not(.admin-preview-active) .future-post-item {
    display: none !important;
}

html.admin-preview-active .future-post-item {
    display: block !important;
}
</style>

{% for post in posts_to_show limit: post_limit %}
    <div class="post-preview-wrapper 
        {% if post.date > site.time %}future-post-item{% endif %}
        {% if post.draft == true %}draft-post-item{% endif %}"
        {% if post.draft == true %}data-draft="true"{% endif %}
        {% if post.preview_key %}data-preview-key="{{ post.preview_key }}"{% endif %}
        style="{% if post.draft == true %}display: none;{% endif %}">
        
        {% include post-preview-news.html post=post %}
        
        {% if post.date > site.time %}
            <div class="future-post-badge-compact">
                <i class="fas fa-clock"></i> 
                Pr√©vu le {% include date-fr.html date=post.date %}
            </div>
        {% endif %}
        
        {% if post.draft == true %}
            <div class="draft-post-badge-compact">
                <i class="fas fa-edit"></i> 
                Brouillon 
                {% if post.preview_key %}<i class="fas fa-lock" title="Acc√®s s√©curis√©"></i>{% endif %}
            </div>
        {% endif %}
    </div>
{% endfor %}